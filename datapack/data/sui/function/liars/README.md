# Liars

## プレイヤー要件

- 最小プレイヤー数: 2 人
- 最大プレイヤー数: 4 人

## ゲーム概要

Liar's bar のマインクラフト版

2~4 人で遊ぶことができる、ライアーズデッキを使ったロシアンルーレットゲームです。

ライアーズデッキは、Q,K,A が 6 枚、ジョーカーが 2 枚の計 20 枚から構成されているデッキを利用する。

ラウンド開始時にジョーカー以外の絵柄が宣言され、プレイヤーは自分のターンで以下のいずれかを選択します：

1. **カードを出す**: 宣言された絵柄のカードを 1〜3 枚出す（嘘をついてもよい）
2. **嘘を指摘**: 前のプレイヤーが嘘をついたと思ったら指摘する

**重要**: パスはできません。必ずカードを出すか、前のプレイヤーを疑わなければなりません。

嘘であることがばれた、もしくは宣言が間違いだった場合は、ロシアンルーレットをプレイすることになる。

最後まで生き残ることができれば勝利となる。

## 実装構造

### ディレクトリ構成

```
liars/
├── README.md         # このファイル
├── cmd/              # プレイヤーが使用するコマンド
│   ├── control/      # ゲーム制御
│   │   ├── start.mcfunction   # ゲーム開始
│   │   └── reset.mcfunction   # ゲームリセット
│   └── matching/     # マッチング機能
│       ├── join.mcfunction    # ゲーム参加
│       └── leave.mcfunction   # ゲーム退出
├── internal/         # 内部実装
│   ├── init.mcfunction        # 初期化処理
│   ├── tick.mcfunction        # メインループ
│   ├── matching/              # マッチングフェーズ
│   │   └── tick.mcfunction
│   └── playing/               # プレイフェーズ
│       └── tick.mcfunction
└── trigger/          # トリガーシステム
    ├── init.mcfunction        # トリガー初期化
    └── tick.mcfunction        # トリガー処理
```

### 使用するスコアボード

- `liars.configs`: ゲーム設定（MIN_PLAYERS, MAX_PLAYERS, GAME_STARTED）
- `liars.participants`: 参加者管理
- `liars.trigger`: トリガーシステム（join, leave, start, reset）

### コマンド使用方法

プレイヤーは以下のトリガーコマンドを使用できます：

- `/trigger liars.join`: ゲームに参加
- `/trigger liars.leave`: ゲームから退出
- `/trigger liars.start`: ゲームを開始（要件を満たす場合）
- `/trigger liars.reset`: ゲームをリセット

## 詳細仕様

### カードシステム

- **カード表現**: カスタムアイテム（CustomModelData 使用）
- **カード選択**: 右クリックで選択可能
- **カード種類**:
  - Queen (Q): 6 枚 - CustomModelData: 1001
  - King (K): 6 枚 - CustomModelData: 1002
  - Ace (A): 6 枚 - CustomModelData: 1003
  - Joker: 2 枚 - CustomModelData: 1004

### ロシアンルーレットシステム

- 各プレイヤーに銃 1 丁を配布
- 1/6 の確率で弾が発射される
- 弾に当たったプレイヤーはゲームオーバー（スペクテイターモードへ移行）

### カードプレイシステム

- **選択方法**: カードアイテムを右クリックで選択
- **確定方法**: 「カードを出す」ボタンをクリック
- **プレイ可能枚数**: 1 ターンに 1〜3 枚（0 枚は不可）
- **ジョーカー**: どのカードとしても使用可能

### 嘘の指摘システム

- **タイミング**: 自分のターン中、前のプレイヤーに対していつでも指摘可能
- **結果**:
  - 嘘が的中: 嘘をついたプレイヤーがロシアンルーレット
  - 嘘が外れ: 指摘したプレイヤーがロシアンルーレット

### ラウンドシステム

- **宣言カード**: 各ラウンド開始時にランダムで選択（Q/K/A のいずれか）
- **ラウンド終了条件**:
  - ロシアンルーレットが発生した場合
  - 全員が同じカードタイプを使い切った場合

### ゲームフロー

1. **マッチングフェーズ**

   - プレイヤーが参加/退出
   - 最小人数（2 人）以上でゲーム開始可能

2. **ゲーム準備フェーズ**

   - 各プレイヤーへのカード配布（Loot table で 5 枚ランダム配布）
   - アクションアイテムの配布
   - 銃の配布
   - ターン順の決定

3. **プレイフェーズ**
   - ラウンド開始: 宣言カードの決定
   - ターン制でカードプレイまたは嘘の指摘
   - 嘘の指摘結果に応じてロシアンルーレット
   - 勝利判定（残り 1 人になったら終了）

### 追加スコアボード

- `liars.game`: ゲーム状態管理
  - `CURRENT_PHASE`: 現在のフェーズ（0:待機, 1:準備, 2:プレイ中）
  - `CURRENT_TURN`: 現在のターンプレイヤー
  - `DECLARED_CARD`: 宣言されたカード種類（1:Q, 2:K, 3:A）
  - `ROUND_NUMBER`: 現在のラウンド数
  - `TURN_COUNT`: 現在のラウンド内のターン数
  - `IS_PREV_LIE`: 前のプレイヤーが嘘をついたか

### 技術的な最適化

- **Predicate 使用**: 条件チェックを効率化
  - プレイヤー状態、カード所持、アイテム判定などに使用
- **Loot Table 使用**: カード配布とアイテム生成を効率化
  - 初期手札配布、アクションアイテム生成に使用
- **関数分離**: 処理を適切に分離して保守性向上

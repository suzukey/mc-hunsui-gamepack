# Liarsゲーム実装コンテキスト

## ゲーム概要
- 2-4人で遊ぶライアーズデッキを使ったロシアンルーレットゲーム
- ライアーズデッキ: Q,K,A各6枚 + ジョーカー2枚の計20枚
- 最後の1人になるまで続く

## フェーズとターンの概念

### フェーズ
- **1フェーズの流れ**: カード配布 → 数ターンのプレイ → ロシアンルーレット → 次フェーズへ
- **フェーズ開始時**:
  1. 勝利判定（残り1人なら終了）
  2. メインカード決定（Q/K/Aからランダム）
  3. 手札リセット＆新規配布
- **最初のプレイヤー**:
  - 1フェーズ目: 座席1のプレイヤー
  - 2フェーズ目以降: 前フェーズの敗者（脱落済みなら次の席）

### ターン
- ターン制（1プレイヤーずつ順番に行動）
- 各ターンの選択肢:
  1. カードをプレイ（1-3枚を伏せて「○枚のメインカード」と宣言）
  2. 前プレイヤーへのダウト宣言
- パスは不可

## カードプレイの詳細
- カードは蓄積されない（前のプレイは消える）
- 宣言: 「○枚の[メインカード]」（枚数のみ選択可、カード種類は固定）
- 実際のカード: メインカード、ジョーカー（ワイルド）、他のカード（嘘）を混ぜてOK

## ダウトシステム
- **ダウト成功条件**: 宣言と実際のカードが一致しない
  - 例: 「2枚のQueen」宣言で実際が「1Queen+1Jack」→ダウト成功
  - ジョーカーはメインカードとして扱う
- **結果**:
  - ダウト成功: 嘘をついたプレイヤーがロシアンルーレット
  - ダウト失敗: ダウトしたプレイヤーがロシアンルーレット

## ロシアンルーレット
- 各プレイヤーに銃1丁（既に実装済み）
- `liars.roulette`: ゲーム開始時に1-6のランダム値
- `liars.trigger`: 敗者に+1加算
- triggerとrouletteが一致で発砲→脱落（スペクテイターモード）

## 実装済みの要素
- 座席システム（seat assignment）
- カード選択/取り消し機能
- ロシアンルーレット基礎（liars.roulette, liars.trigger）
- 基本的なスコアボード構造
- カードアイテム（CustomModelData: Q=1001, K=1002, A=1003, Joker=1004）

## 必要な実装
1. フェーズ管理システム
   - 勝利判定
   - メインカード決定
   - 手札配布/リセット
   - フェーズ終了判定
2. ターン管理システム
   - プレイヤー順番制御
   - 行動選択（カードプレイ or ダウト）
   - ターン終了処理
3. カード判定ロジック
   - 宣言と実際のカードの照合
   - ジョーカーのワイルドカード処理
4. ゲーム進行の状態遷移
   - matching → playing → 各フェーズ → 勝利判定

## スコアボード（README.mdより）
- `liars.game.CURRENT_PHASE`: フェーズ管理
- `liars.game.CURRENT_TURN`: 現在のターンプレイヤー
- `liars.game.DECLARED_CARD`: 宣言されたカード種類（1:Q, 2:K, 3:A）
- `liars.game.ROUND_NUMBER`: 現在のラウンド数
- `liars.game.TURN_COUNT`: ターン数
- `liars.game.IS_PREV_LIE`: 前プレイヤーの嘘フラグ（未使用？）